$home.pages=function(){return{"dashboard-page":{title:$($("#navbar > ul > li > a").get(0)).text(),init:function(){$("#dashboard-page-print").click(function(){$home.navigation.modal("print-sale")})}},"sale-management":{title:$($("#navbar > ul > li > a").get(1)).text(),init:function(){function a(n){var t=0;return $.each(n.Items,function(n,i){t+=i.UnitPrice*i.Quantity}),t}function v(n){var t="";return $.each(n.CustomerContacts,function(n,i){var r="";$.each($home.pages.internal.contactMethods,function(n,t){t.value===i.Method&&(r=t.text)});t.length>0&&(t+="，");t+=r;t+="：";t+=i.Value}),t+="。"}function u(u,c){var k;if(u){var w="Status eq Home.Services.SaleService.SaleStatus'Ok'",p=e.datepicker("getDate"),l=o.datepicker("getDate"),b=s.val();p&&(p=$home.utility.odata.toODataDateTimeOffset(p),p=odatajs.oData.utils.formatDateTimeOffset(p),w+=" and Created ge "+p);l&&(l.setDate(l.getDate()+1),l=$home.utility.odata.toODataDateTimeOffset(l),l=odatajs.oData.utils.formatDateTimeOffset(l),w+=" and Created lt "+l);b.length>0&&(b="'"+b+"'",w+=" and SalesPersonName eq "+b);h="/salesservice/Sales?$expand="+encodeURIComponent("CustomerContacts,Items(")+"$filter="+encodeURIComponent("Status eq Home.Services.SaleService.SaleStatus'Ok')")+"&$filter="+encodeURIComponent(w)+"&$orderby="+encodeURIComponent("Created,SalesPersonName")}k=h+"&$skip="+c+"&$top="+t;odatajs.oData.read(k,function(u){$("tbody",f).empty();$.each(u.value,function(n,t){$("<tr/>").append($("<td/>").append($("<a href='javascript:void(0)' role='button'/>").text(t.NumberText))).append($("<td/>").text(t.CustomerName)).append($("<td/>").text(v(t))).append($("<td/>").text(a(t))).append($("<td/>").text(t.SalesPersonName)).append($("<td/>").text($home.utility.date.toLocalDateTimeString(new Date(t.Created)))).append($("<td/>").text($home.utility.date.toLocalDateTimeString(new Date(t.Modified)))).appendTo($("tbody",f)).data(t)});$("tbody > tr > td > a",f).click(function(){var n=$(this).parent().parent().data();y(n)});n=c;n===0?i.parent().addClass("disabled"):i.parent().removeClass("disabled");u.value.length<t?r.parent().addClass("disabled"):r.parent().removeClass("disabled")},function(){alert("查询失败。")})}function y(t){$home.navigation.modal("sale-view",function(){u(!1,n)},t)}function p(){$home.navigation.modal("sale-report")}var t=50,e=$("#sale-management-from"),o=$("#sale-management-to"),s=$("#sale-management-sale-person"),c=$("#sale-management-search"),f=$("#sale-management-result"),i=$("#sale-management-prev"),r=$("#sale-management-next"),l=$("#sale-management-report"),h=null,n=0;odatajs.oData.read("/securityservice/Users?$orderby=DisplayName desc",function(n){$.each(n.value,function(n,t){$("<option/>").val(t.DisplayName).text(t.DisplayName).appendTo(s)})},function(){alert("初始化"+$home.pages["sale-management"].title+"失败。")});i.parent().addClass("disabled");r.parent().addClass("disabled");e.datepicker({maxDate:"+0d"});o.datepicker({maxDate:"+0d"});c.click(function(){u(!0,0)});i.click(function(){if(!$(this).parent().hasClass("disabled")){var i=n-t;i<0&&(i=0);u(!1,i)}});r.click(function(){$(this).parent().hasClass("disabled")||u(!1,n+t)});l.click(function(){p()})}},"product-management":{title:$($("#navbar > ul > li > a").get(2)).text(),init:function(){$("#product-management-diamond-on-sale").click(function(){$home.navigation.navigate("diamond-on-sale")});$("#product-management-diamond-import").click(function(){$home.navigation.modal("diamond-import")});$("#product-management-diamond-history").click(function(){$home.navigation.navigate("diamond-history")})}},"sale-view":{title:"销售记录",init:function(n){function l(n){n?(r.removeProp("disabled"),f.removeProp("readonly"),$("input",u).removeProp("readonly"),$("select, button",u).removeProp("disabled"),$("input",t).not("#sale-view-total-price").removeProp("readonly"),$("select, button",t).removeProp("disabled"),e.prop("disabled",!0),o.removeProp("disabled"),s.removeProp("disabled")):(r.prop("disabled",!0),f.prop("readonly",!0),$("input",u).prop("readonly",!0),$("select, button",u).prop("disabled",!0),$("input",t).prop("readonly",!0),$("select, button",t).prop("disabled",!0),e.removeProp("disabled"),o.prop("disabled",!0),s.prop("disabled",!0))}function a(){var n=0;$("> div",t).each(function(){var t=$("input.quantity",$(this)),i=$("input.price",$(this)),r,u;t.size()===1&&i.size()===1&&(r=parseInt(t.val()),u=parseInt(i.val()),n+=r*u)});g.val(n)}function nt(){n.SalesPersonName=r.val();n.CustomerName=f.val();n.CustomerContacts[0].Method=$("input[type=hidden]",$("#sale-view-customer-contact-1").parent()).val();n.CustomerContacts[0].Value=$("#sale-view-customer-contact-1").val();n.CustomerContacts[1].Method=$("input[type=hidden]",$("#sale-view-customer-contact-2").parent()).val();n.CustomerContacts[1].Value=$("#sale-view-customer-contact-2").val();var i,u=0;$("> div",t).not(":first").each(function(t){var r=$(this);t%2==0?(i=n.Items[u],u++,i.ProductName=$($("input[type=text]",r)[0]).val(),i.Certificate=$($("input[type=text]",r)[1]).val().length>0?$($("input[type=text]",r)[1]).val():undefined,i.Caret=$($("input[type=number]",r)[0]).val().length>0?parseFloat($($("input[type=number]",r)[0]).val()):undefined,i.Cut=$($("select",r)[0]).val().length>0?$($("select",r)[0]).val():undefined,i.Clarity=$($("select",r)[1]).val().length>0?$($("select",r)[1]).val():undefined,i.Color=$($("select",r)[2]).val().length>0?$($("select",r)[2]).val():undefined):(i.ProductDescription=$($("input[type=text]",r)[0]).val(),i.Quantity=parseInt($($("input[type=number]",r)[0]).val()),i.UnitPrice=parseInt($($("input[type=number]",r)[1]).val()))});n["CustomerContacts@odata.context"]=undefined;n["Items@odata.context"]=undefined;odatajs.oData.request({requestUri:"/salesservice/Sales("+n.Id+")",method:"PUT",data:n,headers:{"if-match":n["@odata.etag"]}},function(){alert("保存成功。");$("#sale-view").modal("hide")},function(){alert("保存失败。")})}function tt(){confirm("确定要删除吗？")&&(n["CustomerContacts@odata.context"]=undefined,n["Items@odata.context"]=undefined,n.CustomerContacts=undefined,n.Items=undefined,n.Status="Bad",odatajs.oData.request({requestUri:"/salesservice/Sales("+n.Id+")",method:"PATCH",data:n,headers:{"if-match":n["@odata.etag"]}},function(){alert("删除成功。");$("#sale-view").modal("hide")},function(){alert("删除失败。")}))}var h="<div class='input-group'>    <div class='input-group-btn'>        <button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown' aria-expanded='false'><span class='caret'><\/span><\/button>        <ul class='dropdown-menu' role='menu'><\/ul>        <input type='hidden'/>    <\/div>    <input type='text' class='form-control input-sm' /><\/div>",v="<div class='col-md-3'>    <div class='form-group'>    <\/div><\/div>",c="<div class='row'><\/div>",i="<div class='col-md-2'>    <div class='form-group'>    <\/div><\/div>",y="<div class='col-md-6'>    <div class='form-group'>    <\/div><\/div>",p=$("#sale-view-receipt-number"),w=$("#sale-view-created"),b=$("#sale-view-created-by"),k=$("#sale-view-modified"),d=$("#sale-view-modified-by"),r=$("#sale-view-saler"),u=$("#sale-view-customer-info"),f=$("#sale-view-name"),t=$("#sale-view-line-info"),g=$("#sale-view-total-price"),e=$("#sale-view-edit"),o=$("#sale-view-save"),s=$("#sale-view-delete");odatajs.oData.read("/securityservice/Users?$orderby=DisplayName",function(g){$.each(g.value,function(n,t){$("<option/>").val(t.DisplayName).text(t.DisplayName).appendTo(r)});p.val(n.NumberText);w.val($home.utility.date.toLocalDateString(new Date(n.Created)));b.val(n.CreatedBy);k.val($home.utility.date.toLocalDateString(new Date(n.Modified)));d.val(n.ModifiedBy);r.val(n.SalesPersonName);f.val(n.CustomerName);$.each(n.CustomerContacts,function(n,t){var f="sale-view-customer-contact-"+(n+1),i=$(h),r;$.each($home.pages.internal.contactMethods,function(n,t){var r=$("<li><a href='javascript:void(0)'><\/a><\/li>");$("a",r).attr("data-content",t.value).text(t.text);$("ul",i).append(r)});$("input[type=text]",i).attr("id",f);$home.ui.selectbutton(i);$("a",i).filter(function(){return $(this).attr("data-content")===t.Method}).click();$("input[type=text]",i).val(t.Value);r=$(v);$(".form-group",r).append($("<label/>").text("联系方式 "+(n+1)).attr("for",f)).append(i);$(".row",u).append(r)});$.each(n.Items,function(n,r){var a="sale-view-product-name-"+(n+1),v="sale-view-product-certificate-"+(n+1),p="sale-view-product-caret-"+(n+1),w="sale-view-product-cut-"+(n+1),b="sale-view-product-clarity-"+(n+1),k="sale-view-product-color-"+(n+1),d="sale-view-product-description-"+(n+1),g="sale-view-product-quantity-"+(n+1),nt="sale-view-product-unit-price-"+(n+1),e=$(h),tt=$("<input type='text' class='form-control input-sm'/>").attr("id",v),it=$("<input type='number' class='form-control input-sm'/>").attr("id",p),o=$("<select class='form-control input-sm'/>").attr("id",w),s=$("<select class='form-control input-sm'/>").attr("id",b),l=$("<select class='form-control input-sm'/>").attr("id",k),rt=$("<input type='text' class='form-control input-sm'/>").attr("id",d),ut=$("<input type='number' class='form-control input-sm quantity'/>").attr("id",g),ft=$("<input type='number' class='form-control input-sm price'/>").attr("id",nt),f,u;$("input[type=text]",e).attr("id",a);$.each($home.pages.internal.products,function(n,t){var i=$("<a href='javascript:void(0)'><\/a>").text(t),r=$("<li/>").append(i);$("ul",e).append(r)});o.append("<option value=''/>");$.each($home.pages.internal.diamondCuts,function(n,t){o.append($("<option/>").val(t).text(t))});s.append("<option value=''/>");$.each($home.pages.internal.diamondClarities,function(n,t){s.append($("<option/>").val(t).text(t))});l.append("<option value=''/>");$.each($home.pages.internal.diamondColors,function(n,t){l.append($("<option/>").val(t).text(t))});$("input",e).val(r.ProductName);r.Certificate&&tt.val(r.Certificate);r.Caret&&it.val(r.Caret);r.Cut&&o.val(r.Cut);r.Clarity&&s.val(r.Clarity);r.Color&&l.val(r.Color);r.ProductDescription&&rt.val(r.ProductDescription);ut.val(r.Quantity);ft.val(r.UnitPrice);f=$(c);u=$(i);$(".form-group",u).append($("<label/>").attr("for",a).text("名称")).append(e);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",v).text("证书")).append(tt);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",p).text("钻重")).append(it);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",w).text("切工")).append(o);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",b).text("净度")).append(s);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",k).text("颜色")).append(l);f.append(u);t.append(f);f=$(c);u=$(y);$(".form-group",u).append($("<label/>").attr("for",d).text("描述")).append(rt);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",g).text("数量")).append(ut);f.append(u);u=$(i);$(".form-group",u).append($("<label/>").attr("for",nt).text("价格")).append(ft);f.append(u);t.append(f);$home.ui.editableselect(e)});a();l(!1);e.click(function(){l(!0)});o.click(nt);s.click(tt);t.off("focusout","input.quantity, input.price").on("focusout","input.quantity, input.price",a)},function(){alert("初始化销售记录对话框失败。")})}},"sale-report":{title:"销售报表",init:function(){function f(u){switch(u.Status){case"Completed":n.removeAttr("disabled");t.removeAttr("disabled");r.removeAttr("disabled");i.prop("disabled",!0);break;case"Running":n.prop("disabled",!0);t.prop("disabled",!0);r.prop("disabled",!0);i.removeAttr("disabled")}}var n=$("#sale-report-from"),t=$("#sale-report-to"),r=$("#sale-report-view"),i=$("#sale-report-cancel"),u=new $home.ssis({name:"sales",prefix:"sale-report",changed:f});n.datepicker({maxDate:"+0d"});t.datepicker({maxDate:"+0d"});i.prop("disabled",!0);r.click(function(){var r=n.datepicker("getDate"),i=t.datepicker("getDate");i.setDate(i.getDate()+1);u.start([{Name:"StartDate",Type:"DateTime",Value:$home.utility.date.toServerDateString(r)},{Name:"EndDate",Type:"DateTime",Value:$home.utility.date.toServerDateString(i)},])});i.click(function(){u.stop()})}},"diamond-on-sale":{title:"在售裸钻",init:function(){}},"diamond-import":{title:"裸钻导入",init:function(){}},"diamond-history":{title:"裸钻上传历史",init:function(){}},"print-sale":{title:"打印售后服务卡和收据",init:function(){function a(t){$("fieldset input, fieldset textarea",n).not(g).prop("readonly",!t);$("fieldset button, fieldset select",n).prop("disabled",!t);t?(y.removeProp("disabled"),p.prop("disabled",!0),w.prop("disabled",!0),$("table > tbody > tr > td > a",n).removeClass("disabled")):(y.prop("disabled",!0),p.removeProp("disabled"),w.removeProp("disabled"),$("table > tbody > tr > td > a",n).addClass("disabled",!0))}function st(){$home.validation.cleanup(rt)}function ht(){$home.validation.cleanup(ut)}function it(){$home.validation.cleanup(ft)}function ct(){e.val("");o.val("");i.val("");r.val("");u.val("");f.val("");s.val("");h.val("");c.val("");it()}function d(){var t=0;$.each($("table > tbody > tr",n),function(n,i){var r=parseInt($("td.quantity",i).text()),u=parseInt($("td.price",i).text());t+=r*u});$("table > tfoot > tr > th.price",n).text(t.toString())}function lt(){if(!$(this).hasClass("disabled")){var t=$(this).parent().parent(),n=t.data();e.val(n.ProductName);o.val(n.Certificate);i.val(n.Caret);r.val(n.Cut);u.val(n.Clarity);f.val(n.Color);s.val(n.ProductDescription);h.val(n.Quantity);c.val(n.UnitPrice);t.remove();d();l.focus()}}function at(){if(!$(this).hasClass("disabled")){var n=$(this).parent().parent();n.remove();d();l.focus()}}function vt(){if(st(),ht(),!$home.validation.validateRequired(b)){alert("请检查用户信息，有未填写的内容，请填写完整。");return}if(!($home.validation.validateRequired(k)&&$home.validation.validateRequired(nt)&&$home.validation.validateRequired(tt))){alert("请检查客户信息，有未填写的内容，请填写完整。");return}if(t.Items=[],$.each($("table > tbody > tr",n),function(n,i){t.Items.push($(i).data())}),t.Items.length===0){alert("没有添加任何商品，请添加商品之后继续。");return}a(!1);t.SalesPersonName=$("#print-sale-user-info option:selected").text();t.CustomerName=k.val();t.CustomerContacts=[{Method:"Phone",Value:nt.val()},{Method:ot.val(),Value:tt.val()}];odatajs.oData.request({requestUri:"/salesservice/Sales",method:"POST",data:t},function(n){g.val(n.NumberText);p.attr("href","/pages/print-service?id="+n.Id);w.attr("href","/pages/print-receipt?id="+n.Id);a(!1);alert("保存成功，可以开始打印。")},function(){alert("保存失败。");a(!0)})}function yt(){function p(){var n="";return o.val().length>0&&(n+="证书："+o.val()+" "),i.val().length>0&&(n+="钻重："+i.val()+" "),r.val().length>0&&(n+="切工："+r.val()+" "),u.val().length>0&&(n+="净度："+u.val()+" "),f.val().length>0&&(n+="颜色："+f.val()+" "),s.val().length>0&&(n+=s.val()),n}var a;if(it(),!($home.validation.validateRequired(e)&&$home.validation.validateFloat(i)&&$home.validation.validateRequired(h)&&$home.validation.validateInteger(h)&&$home.validation.validateRequired(c)&&$home.validation.validateInteger(c))){alert("请检查商品信息，有未填写的内容，请填写完整。");return}var v=parseInt(h.val()),y=parseInt(c.val()),t={ProductName:e.val(),ProductDescription:s.val(),Quantity:v,UnitPrice:y};o.val().length>0&&(t.Certificate=o.val());i.val().length>0&&(t.Caret=parseFloat(i.val()));r.val().length>0&&(t.Cut=r.val());u.val().length>0&&(t.Clarity=u.val());f.val().length>0&&(t.Color=f.val());a=$("<tr><\/tr>").append($("<td><\/td>").text(e.val())).append($("<td><\/td>").text(p())).append($("<td class='quantity'><\/td>").text(v.toString())).append($("<td class='price'><\/td>").text(y.toString())).append("<td class='edit'><a href='javascript:void(0)' title='修改' role='button'><span class='glyphicon glyphicon-pencil' aria-hidden='true'><\/span><\/a><a href='javascript:void(0)' title='删除' role='button'><span class='glyphicon glyphicon-remove' aria-hidden='true'><\/span><\/a><\/td>").data(t).appendTo("table > tbody",n);$("a:first",a).click(lt);$("a:last",a).click(at);d();ct();l.focus()}var t={},n=$("#print-sale"),rt=$("#print-sale-user-info"),ut=$("#print-sale-customer-info"),ft=$("#print-sale-good-info"),v=$("#print-sale-customer-way-button"),l=$("#print-sale-good-name-button"),et=$("#print-sale-add-good"),y=$("#print-sale-save"),p=$("#print-sale-print-service"),w=$("#print-sale-print-receipt"),b=$("#print-sale-user"),g=$("#print-sale-receipt-number"),k=$("#print-sale-customer-name"),nt=$("#print-sale-customer-phone"),tt=$("#print-sale-customer-contact"),ot=$("#print-sale-customer-way"),e=$("#print-sale-good-name"),o=$("#print-sale-good-certificate"),i=$("#print-sale-good-caret"),r=$("#print-sale-good-cut"),u=$("#print-sale-good-clarity"),f=$("#print-sale-good-color"),s=$("#print-sale-good-description"),h=$("#print-sale-good-quantity"),c=$("#print-sale-good-price");odatajs.oData.read("/securityservice/Users?$orderby=DisplayName",function(t){$.each(t.value,function(n,t){$("<option/>").val(t.Id).text(t.DisplayName).appendTo(b)});$.each($home.pages.internal.contactMethods,function(n,t){var i=$("<li><a href='javascript:void(0)'><\/a><\/li>");$("a",i).attr("data-content",t.value).text(t.text);v.next().append(i)});$home.ui.selectbutton(v.parent());$("ul > li > a:first",v.parent()).click();$.each($home.pages.internal.products,function(n,t){var i=$("<a href='javascript:void(0)'><\/a>").text(t),r=$("<li/>").append(i);$(l.next()).append(r)});$home.ui.editableselect(e.parent());$.each($home.pages.internal.diamondCuts,function(n,t){r.append($("<option/>").val(t).text(t))});$.each($home.pages.internal.diamondClarities,function(n,t){u.append($("<option/>").val(t).text(t))});$.each($home.pages.internal.diamondColors,function(n,t){f.append($("<option/>").val(t).text(t))});n.on("shown.bs.modal",function(){b.val($home.authentication.getUserInfo().id);k.focus()});a(!0);et.click(yt);y.click(vt)},function(){alert("初始化打印售后服务卡和收据对话框失败。")})}},internal:{products:["裸钻","女戒","男戒","对戒","吊坠","项链","手链","耳钉","翡翠","碧玺","男戒托","女戒托"],contactMethods:[{value:"WeiXin",text:"微信"},{value:"QQ",text:"QQ"},{value:"Email",text:"电子邮件"},{value:"Phone",text:"电话"},{value:"Other",text:"其它"}],diamondCuts:["EX","VG","G","F","P"],diamondClarities:["FL","IF","VVS1","VVS2","VS1","VS2","SI1","SI2","I1","I2","I3"],diamondColors:["D","E","F","G","H","I","J","K","L","M","N"]}}}();$home.navigation=function(){return{navigate:function(n){var t=$home.pages[n],i=$home.navigation.internal.createArguments(arguments,1);$home.navigation.internal.invoke(n).done(function(n){$("h1").text(t.title);$("#content").html(n);t.init.apply(null,i)}).fail(function(n){n.status===401?alert("您没有权限导航到"+t.title+"。"):alert("导航到"+t.title+"失败。")})},modal:function(n,t){var i=$home.pages[n],r=$home.navigation.internal.createArguments(arguments,2);$home.navigation.internal.invoke(n).done(function(u){$("#dialog").html(u);i.init.apply(null,r);$("#"+n).on("hidden.bs.modal",function(){$("#dialog").empty();t&&t()}).modal("show")}).fail(function(n){n.status===401?alert("您没有权限打开"+i.title+"对话框。"):alert("打开"+i.title+"对话框失败。")})},embed:function(n,t){var i=$home.pages[n],r=$home.navigation.internal.createArguments(arguments,2);$home.navigation.internal.invoke(n).done(function(n){$(t).html(n);i.init.apply(null,r)}).fail(function(n){n.status===401?alert("您没有权限查看"+i.title+"。"):alert("查看"+i.title+"失败。")})},internal:{invoke:function(n){return $.ajax({url:"/pages/"+n,method:"GET",cache:!0})},createArguments:function(n,t){if(n.length>t){var i=[];return $.each(n,function(n,r){n>t-1&&i.push(r)}),i}}}}}();$home.authentication=function(){return{timeout:new $home.observable,isTimeout:function(){return $home.authentication.internal.isTimeout},restart:function(){$home.authentication.internal.timeoutHandle&&clearTimeout($home.authentication.internal.timeoutHandle);$home.authentication.internal.timeoutHandle=setTimeout(function(){$.ajax({type:"POST",url:"/account/logout",headers:{RequestVerificationToken:$("#login-form input[name=__AjaxRequestVerificationToken]").val()},cache:!1}).complete(function(){clearTimeout($home.authentication.internal.timeoutHandle);$home.authentication.internal.isTimeout=!0;$home.authentication.timeout.fire();$home.authentication.exit()})},36e5)},exit:function(){$("body").append("<div class='home-timeout'><div>您的登录超时，请<a href='/account/login'>重新登录<\/a>。<\/div><\/div>")},initialize:function(){$home.authentication.restart();$home.authentication.internal.initializeAjax();$home.authentication.internal.initializeOData();$.ajax({type:"GET",url:"/account/check",dataType:"json",cache:!1}).done(function(n){n.IsLoggedIn?($home.authentication.internal.userId=n.Id,$home.authentication.internal.userName=n.Name,$home.authentication.internal.userRole=n.Role,$home.authentication.internal.initializeUI(),$("#identity").text(n.Name),$home.navigation.navigate("dashboard-page")):$home.authentication.login()}).fail(function(){alert("检查登录状态失败。")})},login:function(){document.location.assign("/account/login")},logout:function(){$("#logout-form").get(0).submit();$home.authentication.internal.userId=null;$home.authentication.internal.userName=null;$home.authentication.internal.userRole=null},getUserInfo:function(){return{id:$home.authentication.internal.userId,Name:$home.authentication.internal.userName,Role:$home.authentication.internal.userRole}},Role:{Administrator:"Administrator",Manager:"Manager",Employee:"Employee"},internal:{isTimeout:!1,timeoutHandle:null,userId:null,userName:null,userRole:null,initializeUI:function(){$.ajax({type:"GET",url:"/permissions",dataType:"json"}).done(function(n){function t(t,i){var r;$.each(n,function(n,i){i.name===t&&$.each(i.roles,function(n,t){t===$home.authentication.internal.userRole&&(r=!0)})});r||$(i).addClass("disabled").hide()}n=JSON.parse(n);$.each($("#navigator > li"),function(n,i){switch(n){case 0:t("dashboard-page",i);break;case 1:t("sale-management",i);break;case 2:t("product-management",i)}})}).fail(function(){alert("检查权限失败。")})},initializeAjax:function(){$(document).ajaxSuccess(function(){$home.authentication.isTimeout()||$home.authentication.restart()}).ajaxError(function(n,t,i,r){$home.authentication.isTimeout()||r.toLowerCase()==="not authorized"||$home.authentication.restart()})},initializeOData:function(){var n=odatajs.oData.defaultSuccess||$.noop,t=odatajs.oData.defaultError||$.noop;odatajs.oData.defaultSuccess=function(){n();$home.authentication.isTimeout()||$home.authentication.restart()};odatajs.oData.defaultError=function(n){t(n);$home.authentication.isTimeout()||n.response.statusCode===401||$home.authentication.restart()}}}}}();$home.ssis=function(){function t(){var t=this.uiRunning,i=this.uiCompleted,r=this.uiCancelled,u=this.options,f=this.timerHandle;odatajs.oData.read("/ssisservice/GetStatus(name='"+encodeURIComponent(this.options.name)+"')",function(e){switch(e.Status){case"Completed":clearInterval(f);t.hide();i.show();r.hide();break;case"Running":t.hide();i.hide();r.show()}u.changed.call(n,e)})}var n=function(){this.options=$.extend({name:null,prefix:null,changed:$.noop},arguments.length===0?{}:arguments[0]);this.uiRunning=$("#"+this.options.prefix+"-ssis-running").hide();this.uiCompleted=$("#"+this.options.prefix+"-ssis-completed").hide();this.uiCancelled=$("#"+this.options.prefix+"-ssis-cancelled").hide()};return n.prototype.start=function(){var i=this.uiRunning,r=this.uiCompleted,u=this.uiCancelled,f=this.timerHandle,e=this.createTimer,n=this;odatajs.oData.request({requestUri:"/ssisservice/Run()",method:"POST",data:{name:this.options.name,parameters:arguments[0]}},function(){i.show();r.hide();u.hide();clearInterval(f);e.call(n);t.call(n)},function(){alert("运行报表失败。")})},n.prototype.stop=function(){var n=this.uiRunning,t=this.uiCompleted,i=this.uiCancelled,r=this.timerHandle;odatajs.oData.request({requestUri:"/ssisservice/Stop()",method:"POST",data:{name:this.options.name}},function(){n.hide();t.hide();i.show();clearInterval(r)},function(){alert("取消报表运行失败。")})},n.prototype.createTimer=function(){var n=this;this.timerHandle=setInterval(function(){t.call(n)},1e4)},n}();$(function(){$home.authentication.initialize();$("#navigator > li > a").click(function(){var n=$(this).parent(),t;if(!n.hasClass("disabled")){t=$("#navigator > li").index(n);switch(t){case 0:$home.navigation.navigate("dashboard-page");break;case 1:$home.navigation.navigate("sale-management");break;case 2:$home.navigation.navigate("product-management")}}});$("#logout").click($home.authentication.logout)});
//# sourceMappingURL=private.min.js.map
